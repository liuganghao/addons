<?xml version='1.0' encoding='utf-8'?>
<openerp>
    <data>

        <record id="view_form_qdodoo_payment_model" model="ir.ui.view">
            <field name="name">qdodoo.payment.model.form</field>
            <field name="model">qdodoo.payment.model</field>
            <field name="arch" type="xml">
                <form string="付款方式">
                    <sheet>
                        <div>
                            请先选择付款方式
                        </div>
                        <field name="name"/>
                    </sheet>
                    <footer>
                        <button name="search_date" string="查看付款通知" type="object" default_focus="1"
                                context="{'name':name}" class="oe_highlight"/>
                    </footer>
                </form>
            </field>
        </record>

        <record id="view_form_qdodoo_car_in_contract" model="ir.ui.view">
            <field name="name">qdodoo.car.in.contract.form</field>
            <field name="model">qdodoo.car.in.contract</field>
            <field name="arch" type="xml">
                <form string="进口合同">
                    <header>
                        <field name="is_payment" invisible="True"/>
                        <button name="wkf_send_rfq" states="draft" string="电邮" type="object" context="{'contract_id':True,'is_contract':True}" class="oe_highlight"/>
                        <button name="wkf_send_rfq" states="sent" string="重发电邮" type="object" context="{'contract_id':True}" class="oe_highlight"/>
                        <button name="print_quotation" string="打印" type="object" states="draft" class="oe_highlight" groups="base.group_user"/>
                        <button name="print_quotation" string="重新打印" type="object" states="sent" class="oe_highlight" groups="base.group_user"/>
                        <button name="btn_message" string="短信" type="object" states="draft" class="oe_highlight" groups="base.group_user"/>
                        <button name="btn_message" string="重发短信" type="object" states="sent" class="oe_highlight" groups="base.group_user"/>
                        <button name="purchase_confirm" string="收到报价单" states="sent"/>
                        <button name="confirm_contract" string="确认合同" states="confirmed"/>
                        <button name="btn_confirmed_sent" string="驳回" states="confirmed"/>
                        <button name="btn_payment_message" string="付款通知" states="approved" type="object"/>
                        <button name="btn_rejected" string="驳回" attrs="{'invisible':['|',('is_payment','=',True),('state','!=','approved')]}"/>
                        <button name="btn_entrust_agent" string="委托代理" states="except_picking" type="object"/>
                        <button name="btn_in_ship" string="查看入库单" states="in_ship" type="object"/>
                        <button name="btn_bill" string="提单" states="except_invoice" type="object"/>
                        <button name="btn_redeem" string="赎车" states="except_invoice" type="object"/>
                        <!--<button name="btn_payment_order" string="结算单" states="except_invoice" type="object"/>-->
                        <button name="action_cancel" states="draft,sent" string="取消" type="object" />
                        <field name="state" widget="statusbar" statusbar_visible="draft,sent,confirmed,approved,except_picking,in_ship,except_invoice,done" statusbar_colors='{"except_picking":"red","except_invoice":"red","confirm_contract":"red"}' readonly="1"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <label string="进口合同"/>
                                <field name="name" class="oe_inline" readonly="1"/>
                            </h1>
                        </div>
                        <div class="oe_right oe_button_box" name="buttons">
                            <button name="btn_read_payment_order" icon="gtk-execute"  string="账务" type="object"/>
                            <button name="btn_read_entrusted_agency" icon="gtk-execute"  string="委托协议" type="object"/>
                            <button name="btn_read_bill_lading" icon="gtk-execute"  string="海运单证" type="object"/>
                        </div>
                        <group>
                            <group>
                                <field name="partner_id" attrs="{'readonly':[('state','!=','draft')],'required':True}" string="供应商" on_change="onchange_partner_id(partner_id, context)" context="{'search_default_supplier':1, 'default_supplier':1, 'default_customer':0}" domain="[('supplier','=',True)]"/>
                                <field string="价格表" domain="[('type','=','purchase')]" name="pricelist_id" groups="product.group_purchase_pricelist" on_change="onchange_pricelist(pricelist_id, context)"/>
                                <field name="currency_id" groups="base.group_multi_currency"/>
                                <field name="journal_id" invisible='1'/>
                                <field name="supplier_contract_version" domain="[('partner_id','=',partner_id)]" attrs="{'readonly':[('state','not in',('draft','sent','confirmed'))]}"/>
                                <field name="contract_number" attrs="{'required':[('state','not in',('draft','sent'))],'readonly':[('state','not in',('draft','sent','confirmed'))]}"/>
                                <field name="contract_date" attrs="{'required':[('state','not in',('draft','sent'))],'readonly':[('state','not in',('draft','sent','confirmed'))]}"/>
                                <field name="car_type" invisible="True"/>
                                <field name="deposit_rate" attrs="{'invisible':[('state','in',('draft'))],'required':[('state','=','confirmed')],'readonly':[('state','not in',('confirmed','sent'))]}"/>
                                <field name="file_name" invisible="True"/>
                                <field name="contract_note" filename="file_name" attrs="{'invisible':[('state','in',('draft','sent'))],'readonly':[('state','not in',('draft','sent','confirmed'))]}"/>
                            </group>
                            <group>
                                <field name="date_order" string="订单日期" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="in_port" attrs="{'readonly':[('state','not in',('draft','sent'))]}"/>
                                <field name="out_port" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="partial_shipment" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="trans_shipment" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="payment_type" attrs="{'required':[('state','not in',('draft','sent'))],'readonly':[('state','not in',('draft','sent','confirmed'))]}"/>
                                <field name="payment_line" attrs="{'readonly':[('state','not in',('draft','sent'))]}"/>
                                <field name="last_ship_date" attrs="{'readonly':[('state','not in',('draft','sent'))]}"/>
                                <field name="origin" attrs="{'invisible': [('origin','=',False)]}"/>
                                <field name="company_id" string="公司" invisible="True" groups="base.group_multi_company" options="{'no_create': True}"/>
                                <field name="picking_type_id" invisible="True" on_change="onchange_picking_type_id(picking_type_id, context)" domain="[('code','=','incoming')]" options="{'no_create': True}" context="{'special_shortened_wh_name': True}" groups="stock.group_locations"/>
                                <field name="related_usage" invisible="1"/>
                                <field name="dest_address_id" string="Customer Address" on_change="onchange_dest_address_id(dest_address_id, context)"
                                    attrs="{'invisible':[('related_usage','!=','customer')],
                                    'required': [('related_usage','=', 'customer')]}"
                                    groups="stock.group_locations"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="货物明细">
                                <field name="order_line" attrs="{'readonly':[('state','not in',('draft','sent','confirmed'))]}">
                                    <tree string="Purchase Order Lines" editable="bottom">
                                        <field name="product_id" attrs="{'readonly':[('state','!=','draft')],'required':True}" on_change="onchange_product_id(parent.pricelist_id,product_id,0,False,parent.partner_id, parent.date_order,parent.fiscal_position,date_planned,False,False,parent.state,context)"/>
                                        <field name="name" attrs="{'readonly':[('state','!=','draft')],'required':True}"/>
                                        <field name="date_planned" invisible="True"/>
                                        <field name="company_id" invisible="True" groups="base.group_multi_company" options="{'no_create': True}"/>
                                        <field name="account_analytic_id" invisible="True" groups="purchase.group_analytic_accounting" domain="[('type','not in',('view','template'))]"/>
                                        <field name="product_qty" attrs="{'readonly':[('state','!=','draft')],'required':True}" on_change="onchange_product_id(parent.pricelist_id,product_id,product_qty,product_uom,parent.partner_id,parent.date_order,parent.fiscal_position,date_planned,name,False,parent.state,context)"/>
                                        <field name="product_uom" groups="product.group_uom" on_change="onchange_product_uom(parent.pricelist_id,product_id,product_qty,product_uom,parent.partner_id, parent.date_order,parent.fiscal_position,date_planned,name,False,parent.state,context)"/>
                                        <field name="price_unit"/>
                                        <field name="taxes_id" invisible="True" widget="many2many_tags" domain="[('parent_id','=',False),('type_tax_use','!=','sale')]"/>
                                        <field name="price_subtotal"/>
                                        <field name="state" invisible="1"/>
                                    </tree>
                                </field>
                                <group class="oe_subtotal_footer oe_right">
                                    <field invisible="True" name="amount_untaxed" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                    <field invisible="True" name="amount_tax" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                    <div class="oe_subtotal_footer_separator oe_inline">
                                        <label for="amount_total"/>
                                        <button name="button_dummy"
                                            states="draft" string="(更新)" type="object" class="oe_edit_only oe_link"/>
                                    </div>
                                    <field name="amount_total" string="合计" nolabel="1" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                </group>
                                <div class="oe_clear"/>
                                <field name="notes" class="oe_inline" placeholder="Terms and conditions..."/>
                            </page>
                            <page string="RFQ &amp; Bid" invisible="True">
                                <group>
                                    <field name="incoterm_id"/>
                                    <field name="bid_date"/>
                                    <field name="bid_validity"/>
                                </group>
                            </page>
                            <page string="Deliveries &amp; Invoices" invisible="True">
                                <group>
                                    <group>
                                        <field name="minimum_planned_date"/>
                                        <field name="location_id" groups="stock.group_locations"/>
                                        <field name="shipped" groups="base.group_no_one"/>
                                    </group>
                                    <group>
                                        <field name="invoice_method"/>
                                        <field name="invoiced"/>
                                        <field name="payment_term_id" options="{'no_open': True, 'no_create': True}"/>
                                        <field name="fiscal_position" attrs="{'readonly': [('invoiced','=', True)]}"/>
                                        <!-- We do not need these fields anymore, the information is in open chatter -->
                                        <field name="validator" groups="base.group_no_one"/>
                                        <field name="date_approve" groups="base.group_no_one"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="view_tree_qdodoo_car_in_contract" model="ir.ui.view">
            <field name="name">qdodoo.car.in.contract.tree</field>
            <field name="model">qdodoo.car.in.contract</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <tree string="进口合同">
                    <field name="message_unread" invisible="1"/>
                    <field name="name" string="单号"/>
                    <field name="date_order" string="订单日期"/>
                    <field name="contract_number"/>
                    <field name="contract_date"/>
                    <field name="partner_id" string="供应商"/>
                    <field name="last_ship_date"/>
                    <field name="car_number"/>
                    <field name="amount_total" string="金额" sum="合计"/>
                    <field name="state" string="状态"/>
                </tree>
            </field>
        </record>
        <record id="action_qdodoo_car_in_contract" model="ir.actions.act_window">
            <field name="name">进口合同</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">qdodoo.car.in.contract</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('is_type','=','contract')]</field>
            <field name="view_id" ref="view_tree_qdodoo_car_in_contract"/>
        </record>
        <menuitem name="进口合同" id="menu_qdodoo_car_in_contract" parent="menu_qdodoo_car_contract"
                  action="action_qdodoo_car_in_contract" sequence="2"/>

        <record id="purchase.purchase_rfq" model="ir.actions.act_window">
            <field name="name">Requests for Quotation</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="context">{}</field>
            <field name="domain">[('state','in',('draft','sent','bid','cancel', 'confirmed')),('is_type','!=','contract')]</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="search_view_id" ref="purchase.view_purchase_order_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a request for quotation.
              </p><p>
                The quotation contains the history of the discussion/negotiation
                you had with your supplier. Once confirmed, a request for
                quotation is converted into a purchase order.
              </p><p>
                Most propositions of purchase orders are created automatically
                by Odoo based on inventory needs.
              </p>
            </field>
        </record>
        <record id="purchase.purchase_form_action" model="ir.actions.act_window">
            <field name="name">Purchase Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.order</field>
            <field name="view_mode">tree,form,graph,calendar</field>
            <field name="context">{}</field>
            <field name="domain">[('state','not in',('draft','sent','bid', 'confirmed')),('is_type','!=','contract')]</field>
            <field name="search_view_id" ref="purchase.view_purchase_order_filter"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a quotation that will be converted into a purchase order.
              </p><p>
                Use this menu to search within your purchase orders by
                references, supplier, products, etc. For each purchase order,
                you can track the related discussion with the supplier, control
                the products received and control the supplier invoices.
              </p>
            </field>
        </record>

        <record id="view_qdodoo_payment_order_form" model="ir.ui.view">
            <field name="name">qdodoo.payment.order.form</field>
            <field name="model">qdodoo.payment.order</field>
            <field name="arch" type="xml">
                <form string="Payment Order">
                <header>
                    <field name="agency_id" invisible="True"/>
                    <button name="open" states="draft" string="Confirm Payments" class="oe_highlight"/>
                    <button name="set_done" states="open" string="Make Payments" type="object" class="oe_highlight"/>
                    <!--<button name="set_to_draft" states="cancel" string="Set to draft" type="object"/>-->
                    <button name="btn_select_order" attrs="{'invisible':[('state','!=','done')]}" states="done" string="查看发票" type="object"/>
                    <button name="cancel" states="draft,open" string="Cancel Payments"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,open"/>
                </header>
                <sheet string="Payment order">
                    <div class="oe_title">
                        <label string="付款通知单" class="oe_edit_only"/>
                        <h1><field name="reference" attrs="{'readonly':[('state','=','cancel')]}"/></h1>
                    </div>
                    <div class=" oe_right oe_button_box">
                        <button class="oe_inline oe_stat_button oe_right" name="%(account_payment.action_create_payment_order)d" string="Invoices" Help="Select Invoices to Pay"
                               type="action" attrs="{'invisible':[('state','=','done')]}" icon="fa-pencil-square-o" widget="statinfo"/>
                    </div>
                    <group>
                        <group>
                            <field name="user_id" attrs="{'readonly':[('state','=','cancel')]}" context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'account.group_account_invoice']}"/>
                            <field name="mode" attrs="{'readonly':[('state','=','cancel')]}"/>
                        </group>
                        <group>
                            <field name="date_prefered" attrs="{'readonly':[('state','=','cancel')]}"/>
                            <field name="date_scheduled" attrs="{'readonly':['|',('date_prefered','!=','fixed'),('state','=','cancel')]}"/>
                            <field name="company_id" attrs="{'readonly':[('state','=','cancel')]}" widget='selection' groups="base.group_multi_company"/>
                        </group>
                    </group>
                    <field name="line_ids" context="{'order_id': active_id or False}" attrs="{'readonly':[('state','=','cancel')]}">
                        <form string="Payment Line">
                            <notebook>
                                <page string="Payment">
                                    <group col="4">
                                        <field name="move_line_id" on_change="onchange_move_line(move_line_id,parent.mode,parent.date_prefered,parent.date_scheduled,currency,company_currency)" domain="[('reconcile_id','=', False), ('credit', '>',0), ('account_id.reconcile', '=', True),('amount_to_pay','>', 0)] "/>
                                        <separator colspan="4" string="Transaction Information"/>
                                        <field name="date"/>
                                        <label for="amount_currency" string="Amount"/>
                                        <div>
                                            <field name="amount_currency" on_change="onchange_amount(amount_currency,currency,company_currency)" class="oe_inline"/>
                                            <field name="currency" nolabel="1" class="oe_inline"/>
                                        </div>
                                        <field name="partner_id" on_change="onchange_partner(partner_id,parent.mode)"/>
                                        <field domain="[('partner_id','=',partner_id)]" name="bank_id"/>
                                        <separator colspan="2" string="Owner Account"/>
                                        <separator colspan="2" string="Destination Account"/>
                                        <field colspan="2" name="info_owner" nolabel="1"/>
                                        <field colspan="2" name="info_partner" nolabel="1"/>
                                        <field colspan="4" name="communication"/>
                                        <field colspan="4" name="communication2"/>
                                        <field name="name"/>
                                        <field name="state"/>
                                        <field name="company_id" widget="selection" groups="base.group_multi_company"/>
                                    </group>
                                </page>
                                <page string="Information">
                                    <group col="4" string="General Information">
                                        <label for="amount" groups="base.group_multi_currency"/>
                                        <div groups="base.group_multi_currency">
                                            <field name="amount" class="oe_inline"/>
                                            <field name="company_currency" class="oe_inline"/>
                                        </div>
                                        <separator colspan="4" string="Entry Information"/>
                                        <field name="create_date" readonly="1"/>
                                        <field name="ml_maturity_date"/>
                                        <field name="ml_inv_ref"/>
                                    </group>
                                </page>
                            </notebook>
                        </form>
                        <tree string="Payment Line">
                            <field name="ml_inv_ref" />
                            <field name="partner_id"/>
                            <field name="communication"/>
                            <field name="bank_id" domain="[('partner_id', '=', partner_id)]"/>
                            <field name="ml_maturity_date"/>
                            <field name="date"/>
                            <field name="amount_currency" string="Amount"/>
                            <field name="currency"/>
                            <field name="name"/>
                            <field name="amount" sum="Total in Company Currency" invisible="1"/>
                        </tree>
                    </field>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="view_qdodoo_payment_order_tree" model="ir.ui.view">
            <field name="name">qdodoo.payment.order.tree</field>
            <field name="model">qdodoo.payment.order</field>
            <field eval="4" name="priority"/>
            <field name="arch" type="xml">
                <tree colors="blue:state == 'draft';gray:state in ('cancel','done');black:state == 'open'" string="Payment order">
                    <field name="reference"/>
                    <field name="mode"/>
                    <field name="user_id"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <field name="date_created"/>
                    <field name="date_done"/>
                    <field name="total"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
        <record id="action_qdodoo_payment_order" model="ir.actions.act_window">
            <field name="name">收付款通知单</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">qdodoo.payment.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('is_qdodoo','=',True)]</field>
            <field name="view_id" ref="view_qdodoo_payment_order_tree"/>
        </record>
        <menuitem name="付款通知单" id="menu_qdodoo_payment_order" parent="menu_qdodoo_account_deal"
                  action="action_qdodoo_payment_order" sequence="2"/>

    </data>
</openerp>